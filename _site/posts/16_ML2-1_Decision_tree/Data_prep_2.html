<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Home - Tree models in ChEMBL data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5CHVP3K63C"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-5CHVP3K63C', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Home</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About Jennifer HY Lin</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jhylin"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@jhylin"><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/jenhylin"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://jhylin.github.io/CV_resume_quarto/">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Tree models in ChEMBL data</h1>
            <p class="subtitle lead">ML series 2.1 - Decision tree - Data pre-processing 2 of 2</p>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#re-import-saved-dataframe" id="toc-re-import-saved-dataframe" class="nav-link active" data-scroll-target="#re-import-saved-dataframe"><strong>Re-import saved dataframe</strong></a></li>
  <li><a href="#compound-sanitisation" id="toc-compound-sanitisation" class="nav-link" data-scroll-target="#compound-sanitisation"><strong>Compound sanitisation</strong></a></li>
  <li><a href="#detect-outliers" id="toc-detect-outliers" class="nav-link" data-scroll-target="#detect-outliers"><strong>Detect outliers</strong></a></li>
  <li><a href="#molecular-descriptors" id="toc-molecular-descriptors" class="nav-link" data-scroll-target="#molecular-descriptors"><strong>Molecular descriptors</strong></a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/jhylin/Data_in_life_blog/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Since data preparation and cleaning was a well-known process that would take up a lot of time, I’ve decided to split this part into two posts to ensure the reading time for each post was reasonable.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import all libraries used</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datamol <span class="im">as</span> dm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<section id="re-import-saved-dataframe" class="level5">
<h5 class="anchored" data-anchor-id="re-import-saved-dataframe"><strong>Re-import saved dataframe</strong></h5>
<p>Re-imported the partly pre-processed dtree_df from the earlier post.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dtree_df <span class="op">=</span> pd.read_csv(<span class="st">"ache_chembl.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dtree_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Unnamed: 0</th>
      <th>molecule_chembl_id</th>
      <th>IC50</th>
      <th>units</th>
      <th>data_validity_comment</th>
      <th>smiles</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>CHEMBL133897</td>
      <td>750.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>CCOc1nn(-c2cccc(OCc3ccccc3)c2)c(=O)o1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>CHEMBL336398</td>
      <td>100.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC1CC1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>CHEMBL130628</td>
      <td>300.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC(F)(F)F</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>CHEMBL130478</td>
      <td>800.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>CSc1nc(-c2ccc(OC(F)(F)F)cc2)nn1C(=O)N(C)C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>CHEMBL130112</td>
      <td>2400.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>CSc1nc(-c2ccc(C)cc2)nn1C(=O)N(C)c1ccccc1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Noticed there was an extra index column, likely inherited from how the .csv file was saved, which was subsequently removed.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dtree_df <span class="op">=</span> dtree_df.drop(<span class="st">"Unnamed: 0"</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dtree_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>molecule_chembl_id</th>
      <th>IC50</th>
      <th>units</th>
      <th>data_validity_comment</th>
      <th>smiles</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CHEMBL133897</td>
      <td>750.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>CCOc1nn(-c2cccc(OCc3ccccc3)c2)c(=O)o1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CHEMBL336398</td>
      <td>100.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC1CC1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CHEMBL130628</td>
      <td>300.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC(F)(F)F</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CHEMBL130478</td>
      <td>800.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>CSc1nc(-c2ccc(OC(F)(F)F)cc2)nn1C(=O)N(C)C</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CHEMBL130112</td>
      <td>2400.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>CSc1nc(-c2ccc(C)cc2)nn1C(=O)N(C)c1ccccc1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>The merged dataframe was found to have IC50 with zero nM, which meant the function to convert IC50 to pIC50 would not proceed (due to natural log of zero normally means undefined answer!). So a good practice to clean data like this was probably best to run a statistical summary such as the code below first, then look for minimum and maximum values and also others to see if there were anything to be tidied up first.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>dtree_df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>IC50</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>5.040000e+03</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>8.070638e+04</td>
    </tr>
    <tr>
      <th>std</th>
      <td>9.511451e+05</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.000000e+02</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.200000e+03</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>9.700000e+03</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.960000e+07</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Limiting the IC50 values to be above zero only.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select IC50 values above zero</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dtree_df <span class="op">=</span> dtree_df[dtree_df[<span class="st">"IC50"</span>] <span class="op">&gt;</span> <span class="fl">0.0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Re-checked the minimum value of IC50 column, which should be above zero.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dtree_df[<span class="st">"IC50"</span>].<span class="bu">min</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>5e-06</code></pre>
</div>
</div>
<p>Now we could convert the IC50 values to pIC50 values (the negative log of IC50 in molar units).</p>
<p>The key to understand pIC50 here was to treat pIC50 similarly to how we understand pH for our acids and bases. pIC50 was a dimensionless value (so no units actually!) - <em>useful link</em>. The formula to convert IC50 to pIC50 for nM units was (<strong>use LaTex for formula</strong>):</p>
<p>pIC50 = 9 - log10(IC50)</p>
<p>Set up a small function to do the conversion.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_pIC50(IC50):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    pIC50_value <span class="op">=</span> <span class="dv">9</span> <span class="op">-</span> math.log10(IC50)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pIC50_value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Applying the calc_pIC50 function to convert all rows of the compound dataset for the IC50 column.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column for pIC50</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply calc_pIC50 function to the data in IC50 column</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>dtree_df[<span class="st">"pIC50"</span>] <span class="op">=</span> dtree_df.<span class="bu">apply</span>(<span class="kw">lambda</span> x: calc_pIC50(x.IC50), axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The dataframe would now look like this, with a new pIC50 column ready for use.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dtree_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>molecule_chembl_id</th>
      <th>IC50</th>
      <th>units</th>
      <th>data_validity_comment</th>
      <th>smiles</th>
      <th>pIC50</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CHEMBL133897</td>
      <td>750.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>CCOc1nn(-c2cccc(OCc3ccccc3)c2)c(=O)o1</td>
      <td>6.124939</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CHEMBL336398</td>
      <td>100.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC1CC1</td>
      <td>7.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CHEMBL130628</td>
      <td>300.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC(F)(F)F</td>
      <td>6.522879</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CHEMBL130478</td>
      <td>800.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>CSc1nc(-c2ccc(OC(F)(F)F)cc2)nn1C(=O)N(C)C</td>
      <td>6.096910</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CHEMBL130112</td>
      <td>2400.0</td>
      <td>nM</td>
      <td>NaN</td>
      <td>CSc1nc(-c2ccc(C)cc2)nn1C(=O)N(C)c1ccccc1</td>
      <td>5.619789</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>However, for a decision tree model, a few more molecular descriptors were probably needed rather than only IC50 or pIC50 and SMILES… One way to do this could be through computations based on canonical SMILES of compounds by using RDKit to add some molecular descriptors.</p>
<p>Before doing this, a compound sanitisation step would probably be the best before starting any calculations, as this might rule out some compounds with questionable chemical validities. This could also be done via RDKit or I guess Datamol (a Python wrapper library built based on RDKit) might also help as well.</p>
<p>I thought to convert the data types of the “smiles” and “data_validity_comment” columns to string first (in case of running into problems later).</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#df['column'].astype('string') </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>dtree_df <span class="op">=</span> dtree_df.astype({<span class="st">"smiles"</span>: <span class="st">"string"</span>, <span class="st">"data_validity_comment"</span>: <span class="st">"string"</span>})</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>dtree_df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>molecule_chembl_id        object
IC50                     float64
units                     object
data_validity_comment     string
smiles                    string
pIC50                    float64
dtype: object</code></pre>
</div>
</div>
<p>Also, before I jumped straight to compound sanitisation, I thought I should check out if there were any comments in the “data_validity_comment” column.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dtree_df[<span class="st">"data_validity_comment"</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>&lt;StringArray&gt;
[&lt;NA&gt;, 'Outside typical range', 'Potential transcription error']
Length: 3, dtype: string</code></pre>
</div>
</div>
<p>Interestingly, there were 3 different types of data validity comments found, which were “NaN”, “Outside typical range” and “Potential transcirption error”. So, this meant we would need to address compounds with comments in the latter two.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find out number of compounds with "outside typical range" as data validity comment</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dtree_df[dtree_df[<span class="st">"data_validity_comment"</span>] <span class="op">==</span> <span class="st">"Outside typical range"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>molecule_chembl_id</th>
      <th>IC50</th>
      <th>units</th>
      <th>data_validity_comment</th>
      <th>smiles</th>
      <th>pIC50</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>19</th>
      <td>CHEMBL46151</td>
      <td>260000.0</td>
      <td>nM</td>
      <td>Outside typical range</td>
      <td>CCN(CC)CCS/C(=N\O)C(=O)c1ccc(OC)cc1</td>
      <td>3.585027</td>
    </tr>
    <tr>
      <th>25</th>
      <td>CHEMBL544022</td>
      <td>520000.0</td>
      <td>nM</td>
      <td>Outside typical range</td>
      <td>CCN(CC)CCS/C(=N\O)C(=O)c1ccc(Cl)cc1.Cl</td>
      <td>3.283997</td>
    </tr>
    <tr>
      <th>38</th>
      <td>CHEMBL33051</td>
      <td>460000.0</td>
      <td>nM</td>
      <td>Outside typical range</td>
      <td>NC(=O)c1cc[n+](COC[n+]2ccccc2/C=N/O)cc1.[Cl-]....</td>
      <td>3.337242</td>
    </tr>
    <tr>
      <th>41</th>
      <td>CHEMBL543546</td>
      <td>330000.0</td>
      <td>nM</td>
      <td>Outside typical range</td>
      <td>CC(C)N(CCS/C(=N\O)C(=O)c1ccc(Cl)cc1)C(C)C.Cl</td>
      <td>3.481486</td>
    </tr>
    <tr>
      <th>42</th>
      <td>CHEMBL1420</td>
      <td>340000.0</td>
      <td>nM</td>
      <td>Outside typical range</td>
      <td>C[n+]1ccccc1C=NO</td>
      <td>3.468521</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4947</th>
      <td>CHEMBL5190179</td>
      <td>785000.0</td>
      <td>nM</td>
      <td>Outside typical range</td>
      <td>OCCCCCCCCc1ccc(CN2CCCCCC2)c(O)c1</td>
      <td>3.105130</td>
    </tr>
    <tr>
      <th>4995</th>
      <td>CHEMBL1668934</td>
      <td>115000.0</td>
      <td>nM</td>
      <td>Outside typical range</td>
      <td>CC(=O)N1CCC(NC(=O)Nc2ccc(OC(F)(F)F)cc2)CC1</td>
      <td>3.939302</td>
    </tr>
    <tr>
      <th>5025</th>
      <td>CHEMBL5219232</td>
      <td>1000000.0</td>
      <td>nM</td>
      <td>Outside typical range</td>
      <td>C#CCN[C@@H]1CCc2ccc(OC(=O)N(C)CC)cc21.C#CCN[C@...</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>5027</th>
      <td>CHEMBL1193656</td>
      <td>150000.0</td>
      <td>nM</td>
      <td>Outside typical range</td>
      <td>C#CCNC1CCc2c(OC(=O)N(C)CC)cccc21</td>
      <td>3.823909</td>
    </tr>
    <tr>
      <th>5029</th>
      <td>CHEMBL1193856</td>
      <td>730000.0</td>
      <td>nM</td>
      <td>Outside typical range</td>
      <td>C#CCN(C)C1CCc2cccc(OC(=O)N(C)C)c21</td>
      <td>3.136677</td>
    </tr>
  </tbody>
</table>
<p>328 rows × 6 columns</p>
</div>
</div>
</div>
<p>There were a total of 328 compounds with IC50 outside typical range!</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find out number of compounds with "potential transcription error" as data validity comment</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>dtree_df[dtree_df[<span class="st">"data_validity_comment"</span>] <span class="op">==</span> <span class="st">"Potential transcription error"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>molecule_chembl_id</th>
      <th>IC50</th>
      <th>units</th>
      <th>data_validity_comment</th>
      <th>smiles</th>
      <th>pIC50</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>753</th>
      <td>CHEMBL189957</td>
      <td>320.0</td>
      <td>nM</td>
      <td>Potential transcription error</td>
      <td>CNC(=O)Oc1cccc(CN(C)CCCCCCCOc2ccc3c(=O)c4ccccc...</td>
      <td>6.494850</td>
    </tr>
    <tr>
      <th>755</th>
      <td>CHEMBL190060</td>
      <td>6860.0</td>
      <td>nM</td>
      <td>Potential transcription error</td>
      <td>CNC(=O)Oc1cccc(CN(C)CCCOc2ccc3c(c2)O/C(=C\c2cc...</td>
      <td>5.163676</td>
    </tr>
    <tr>
      <th>756</th>
      <td>CHEMBL191386</td>
      <td>3410.0</td>
      <td>nM</td>
      <td>Potential transcription error</td>
      <td>CNC(=O)Oc1cccc(CN(C)CCCOc2ccc3c(c2)O/C(=C\c2cc...</td>
      <td>5.467246</td>
    </tr>
    <tr>
      <th>761</th>
      <td>CHEMBL370961</td>
      <td>1950.0</td>
      <td>nM</td>
      <td>Potential transcription error</td>
      <td>CNC(=O)Oc1cccc(CN(C)CCCCCCCOc2ccc3c(c2)O/C(=C\...</td>
      <td>5.709965</td>
    </tr>
    <tr>
      <th>762</th>
      <td>CHEMBL372710</td>
      <td>8000.0</td>
      <td>nM</td>
      <td>Potential transcription error</td>
      <td>CNC(=O)Oc1cccc(CN(C)CCCCCCCOc2ccc3c(c2)O/C(=C\...</td>
      <td>5.096910</td>
    </tr>
    <tr>
      <th>763</th>
      <td>CHEMBL364678</td>
      <td>44600.0</td>
      <td>nM</td>
      <td>Potential transcription error</td>
      <td>CNC(=O)Oc1cccc(CN(C)CCCCCCCOc2ccc3c(c2)O/C(=C\...</td>
      <td>4.350665</td>
    </tr>
    <tr>
      <th>764</th>
      <td>CHEMBL191461</td>
      <td>1800.0</td>
      <td>nM</td>
      <td>Potential transcription error</td>
      <td>CNC(=O)Oc1cccc(CN(C)CCCCCCCOc2ccc3c(c2)C/C(=C\...</td>
      <td>5.744727</td>
    </tr>
    <tr>
      <th>1030</th>
      <td>CHEMBL239046</td>
      <td>7160.0</td>
      <td>nM</td>
      <td>Potential transcription error</td>
      <td>CCN(Cc1ccccc1)Cc1ccc(-c2cc3cc(OCCNC(=O)/C=C/c4...</td>
      <td>5.145087</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>There were 8 compounds with potential transcription errors for their respective IC50 values!</p>
<p>This meant it would be best to remove above compounds with questionable IC50 values (could be potential sources of errors for ML models later on). One of the ways I thought of doing was to fill the empty cells under “data_validity_comment” column, so this would be easier to filter.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill "NaN" entries with an actual name e.g. zero</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>dtree_df <span class="op">=</span> dtree_df.fillna(<span class="st">"zero"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>dtree_df.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>molecule_chembl_id</th>
      <th>IC50</th>
      <th>units</th>
      <th>data_validity_comment</th>
      <th>smiles</th>
      <th>pIC50</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CHEMBL133897</td>
      <td>750.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>CCOc1nn(-c2cccc(OCc3ccccc3)c2)c(=O)o1</td>
      <td>6.124939</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CHEMBL336398</td>
      <td>100.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC1CC1</td>
      <td>7.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CHEMBL130628</td>
      <td>300.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC(F)(F)F</td>
      <td>6.522879</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CHEMBL130478</td>
      <td>800.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>CSc1nc(-c2ccc(OC(F)(F)F)cc2)nn1C(=O)N(C)C</td>
      <td>6.096910</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CHEMBL130112</td>
      <td>2400.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>CSc1nc(-c2ccc(C)cc2)nn1C(=O)N(C)c1ccccc1</td>
      <td>5.619789</td>
    </tr>
    <tr>
      <th>5</th>
      <td>CHEMBL130098</td>
      <td>100.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>CSc1nc(-c2ccc(Cl)cc2)nn1C(=O)N(C)C</td>
      <td>7.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>CHEMBL336538</td>
      <td>800.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>COc1ccc(-c2nc(SC)n(C(=O)N(C)C)n2)cc1</td>
      <td>6.096910</td>
    </tr>
    <tr>
      <th>7</th>
      <td>CHEMBL335033</td>
      <td>50.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>CSc1nc(-c2ccc3ccccc3c2)nn1C(=O)N(C)C</td>
      <td>7.301030</td>
    </tr>
    <tr>
      <th>8</th>
      <td>CHEMBL338720</td>
      <td>560.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>CSc1nc(-c2ccc(-c3ccccc3)cc2)nn1C(=O)N(C)C</td>
      <td>6.251812</td>
    </tr>
    <tr>
      <th>9</th>
      <td>CHEMBL131536</td>
      <td>1400.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>CSc1nc(-c2ccc(Cl)cc2)nn1C(=O)N(C)c1ccccc1</td>
      <td>5.853872</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Filtered out only the compounds with nil data validity comments.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dtree_df["data_validity_comment"].unique()</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dtree_df <span class="op">=</span> dtree_df[dtree_df[<span class="st">"data_validity_comment"</span>] <span class="op">==</span> <span class="st">"zero"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Checking the dtree_df dataframe again and also whether if only the compounds with “zero” labelled for “data_validity_comment” column were kept (and other two types were removed).</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dtree_df.shape)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dtree_df[<span class="st">"data_validity_comment"</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(4703, 6)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>&lt;StringArray&gt;
['zero']
Length: 1, dtype: string</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="compound-sanitisation" class="level4">
<h4 class="anchored" data-anchor-id="compound-sanitisation"><strong>Compound sanitisation</strong></h4>
<p>I’ve found the <a href="https://docs.datamol.io/stable/tutorials/Preprocessing.html">pre-processing molecules tutorial</a> and its reference links provided by Datamol at the bottom of the webpage to be very informative. Each steps of fix_mol(), sanitize_mol() and standardize_mol() were explained to a certain degree in the link provided above. I guess the key was to select pre-processing options required to fit the purpose of the ML models being built later on, and more experiences in doing this would also help to improve the compound pre-processing step.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _preprocess function to sanitise compounds - adapted from datamol.io</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>smiles_column <span class="op">=</span> <span class="st">"smiles"</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>dm.disable_rdkit_log()</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _preprocess(row):</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert each compound to a RDKit molecule in the smiles column</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    mol <span class="op">=</span> dm.to_mol(row[smiles_column], ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fix common errors in the molecules</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    mol <span class="op">=</span> dm.fix_mol(mol)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sanitise the molecules </span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    mol <span class="op">=</span> dm.sanitize_mol(mol, sanifix<span class="op">=</span><span class="va">True</span>, charge_neutral<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Standardise the molecules</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    mol <span class="op">=</span> dm.standardize_mol(</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        mol,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        disconnect_metals<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        normalize<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        reionize<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Decided to switch on "uncharge" to neutralise charges - the only change</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        uncharge<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>        stereo<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Added a new column below for RDKit molecules</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    row[<span class="st">"rdkit_mol"</span>] <span class="op">=</span> dm.to_mol(mol)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>    row[<span class="st">"standard_smiles"</span>] <span class="op">=</span> dm.standardize_smiles(dm.to_smiles(mol))</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    row[<span class="st">"selfies"</span>] <span class="op">=</span> dm.to_selfies(mol)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    row[<span class="st">"inchi"</span>] <span class="op">=</span> dm.to_inchi(mol)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    row[<span class="st">"inchikey"</span>] <span class="op">=</span> dm.to_inchikey(mol)</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> row</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then the compound sanitisation function was applied to the dtree_df.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>dtree_san_df <span class="op">=</span> dtree_df.<span class="bu">apply</span>(_preprocess, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dtree_san_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>molecule_chembl_id</th>
      <th>IC50</th>
      <th>units</th>
      <th>data_validity_comment</th>
      <th>smiles</th>
      <th>pIC50</th>
      <th>rdkit_mol</th>
      <th>standard_smiles</th>
      <th>selfies</th>
      <th>inchi</th>
      <th>inchikey</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CHEMBL133897</td>
      <td>750.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>CCOc1nn(-c2cccc(OCc3ccccc3)c2)c(=O)o1</td>
      <td>6.124939</td>
      <td>&lt;rdkit.Chem.rdchem.Mol object at 0x123eab5a0&gt;</td>
      <td>CCOc1nn(-c2cccc(OCc3ccccc3)c2)c(=O)o1</td>
      <td>[C][C][O][C][=N][N][Branch2][Ring1][Branch1][C...</td>
      <td>InChI=1S/C17H16N2O4/c1-2-21-16-18-19(17(20)23-...</td>
      <td>GUZKBNUSIOHJIR-UHFFFAOYSA-N</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CHEMBL336398</td>
      <td>100.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC1CC1</td>
      <td>7.000000</td>
      <td>&lt;rdkit.Chem.rdchem.Mol object at 0x123eab450&gt;</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC1CC1</td>
      <td>[O][=C][Branch1][=Branch2][N][C][C][C][C][C][R...</td>
      <td>InChI=1S/C18H21ClN4OS/c19-15-8-6-14(7-9-15)16-...</td>
      <td>XWIIHZHUZCWNLW-UHFFFAOYSA-N</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CHEMBL130628</td>
      <td>300.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC(F)(F)F</td>
      <td>6.522879</td>
      <td>&lt;rdkit.Chem.rdchem.Mol object at 0x123eab4c0&gt;</td>
      <td>O=C(N1CCCCC1)n1nc(-c2ccc(Cl)cc2)nc1SCC(F)(F)F</td>
      <td>[O][=C][Branch1][=Branch2][N][C][C][C][C][C][R...</td>
      <td>InChI=1S/C16H16ClF3N4OS/c17-12-6-4-11(5-7-12)1...</td>
      <td>GTBUYLWBDILEPY-UHFFFAOYSA-N</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CHEMBL130478</td>
      <td>800.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>CSc1nc(-c2ccc(OC(F)(F)F)cc2)nn1C(=O)N(C)C</td>
      <td>6.096910</td>
      <td>&lt;rdkit.Chem.rdchem.Mol object at 0x123eaae30&gt;</td>
      <td>CSc1nc(-c2ccc(OC(F)(F)F)cc2)nn1C(=O)N(C)C</td>
      <td>[C][S][C][=N][C][Branch2][Ring1][Ring2][C][=C]...</td>
      <td>InChI=1S/C13H13F3N4O2S/c1-19(2)12(21)20-11(23-...</td>
      <td>FBOHEFQKBNWFPO-UHFFFAOYSA-N</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CHEMBL130112</td>
      <td>2400.0</td>
      <td>nM</td>
      <td>zero</td>
      <td>CSc1nc(-c2ccc(C)cc2)nn1C(=O)N(C)c1ccccc1</td>
      <td>5.619789</td>
      <td>&lt;rdkit.Chem.rdchem.Mol object at 0x123eaaea0&gt;</td>
      <td>CSc1nc(-c2ccc(C)cc2)nn1C(=O)N(C)c1ccccc1</td>
      <td>[C][S][C][=N][C][Branch1][N][C][=C][C][=C][Bra...</td>
      <td>InChI=1S/C18H18N4OS/c1-13-9-11-14(12-10-13)16-...</td>
      <td>AAXQEELWFXEVAH-UHFFFAOYSA-N</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Please note if the dataset required for sanitisation is large, Datamol has suggested using their example code to add parallelisation as shown below.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Code adapted from: https://docs.datamol.io/stable/tutorials/Preprocessing.html#references</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>data_clean <span class="op">=</span> dm.parallelized(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    _preprocess, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    data.iterrows(), </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    arg_type<span class="op">=</span><span class="st">"args"</span>, </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    total<span class="op">=</span><span class="bu">len</span>(data)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>data_clean <span class="op">=</span> pd.DataFrame(data_clean)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dtree_san_df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>(4703, 11)</code></pre>
</div>
</div>
<p>In this case, I tried using the preprocessing function without adding the parallelisation, the whole sanitisation process wasn’t overly long, and was done within a minute or so (the dtree_df dataframe had 4,703 rows or compounds only).</p>
<p><br></p>
</section>
<section id="detect-outliers" class="level4">
<h4 class="anchored" data-anchor-id="detect-outliers"><strong>Detect outliers</strong></h4>
<p>Plotting a histogram to see the distribution of pIC50 values first.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dtree_san_df.hist(column <span class="op">=</span> <span class="st">"pIC50"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>array([[&lt;AxesSubplot: title={'center': 'pIC50'}&gt;]], dtype=object)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data_prep_2_files/figure-html/cell-21-output-2.png" width="583" height="431"></p>
</div>
</div>
<p>I read a bit about Dixon’s Q test and realised that there were a few required assumptions prior to using this test, and the current dataset being used here (dtree_san_df) might not fit the requirements, which were:</p>
<ul>
<li>normally distributed data</li>
<li>a small sample size e.g.&nbsp;between 3 and 10 (as originally stated in the paper published by R. B. Dean and W. J. Dixon (1951) Simplified Statistics for Small Numbers of Observations”. Anal. Chem., 1951, 23 (4), 636–638).</li>
</ul>
<p>So I’ve decided that rather than showing Python code for Dixon’s Q test myself, I’d attach a few examples from others instead, <a href="https://plotly.com/python/v3/outlier-test/">Q test from Plotly</a> and also <a href="https://sebastianraschka.com/Articles/2014_dixon_test.html">Dixon’s Q test for outlier identification – a questionable practice</a>, since this dataset here wasn’t quite normally distributed as shown from the histogram plotted above.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dtree_san_df.boxplot(column <span class="op">=</span> <span class="st">"pIC50"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the boxplot version below shows a blank background</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rather than above version with horizontal grid lines</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#dtree_san_df.plot.box(column = "pIC50")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>&lt;AxesSubplot: &gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Data_prep_2_files/figure-html/cell-22-output-2.png" width="566" height="411"></p>
</div>
</div>
<p>So I used Pandas’ built-in boxplot in addition to the histogram to show the likely outliers within the pIC50 values. Clearly, the possible outliers for pIC50 values appeared to be close to 10 and above. I’ve then decided not to completely remove these outliers due to the dataset itself being not in a Gaussian distribution (which meant they might not be true outliers).</p>
<p><br></p>
</section>
<section id="molecular-descriptors" class="level4">
<h4 class="anchored" data-anchor-id="molecular-descriptors"><strong>Molecular descriptors</strong></h4>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="jhylin/Data_in_life_blog" data-repo-id="R_kgDOHw7lGQ" data-category="General" data-category-id="DIC_kwDOHw7lGc4CQzQ_" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Website made with ❤️ in <a href="https://quarto.org/">Quarto</a> by Jennifer HY Lin © 2022 - 2023 📕 Citation as author and URL link if used</div>
  </div>
</footer>



</body></html>