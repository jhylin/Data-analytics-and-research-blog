{
  "hash": "65fa4933c3ac44b03b65eb117b6432d7",
  "result": {
    "markdown": "---\ntitle: Table scraping from PDF\nsubtitle: Using tabula-py in Python\nauthor: Jennifer HY Lin\ndate: '2022-09-15'\ncategories:\n  - Data analytics projects\n  - Python\n  - Long COVID\n---\n\n##### **Quick introduction**\n\nRecently I had the idea of continuing the long COVID exploration and thought that I've never tried scraping a PDF before, so by combining these two ideas together, I ended up with this little piece of work as another post.\n\nA quick heads up: Java should be installed in order for tabula-py to work seamlessly, since tabula-py is actually a Python wrapper for tabula-java. In this case, I've relied on Homebrew to install Java, but there are several other different options available online and I'll leave this open for people who're interested to explore themselves. Once it's installed, we can then check for the Java version to ensure it's installed properly.\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\n# Check the version of Java\n!java -version\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nopenjdk version \"17.0.4.1\" 2022-08-12\r\nOpenJDK Runtime Environment Temurin-17.0.4.1+1 (build 17.0.4.1+1)\r\nOpenJDK 64-Bit Server VM Temurin-17.0.4.1+1 (build 17.0.4.1+1, mixed mode, sharing)\r\n```\n:::\n:::\n\n\n##### **Installing and importing libraries**\n\nThen we would install any libraries needed for scraping table data from PDF, which in this case, I ended up using only one library.\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\n!pip install -q tabula-py\n```\n:::\n\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\n# import read_pdf from the tabula library\nfrom tabula import read_pdf\n```\n:::\n\n\n##### **Data source**\n\nSource of the table was from this journal paper by Healey Q, Sheikh A, Daines L, Vasileiou E. Symptoms and signs of long COVID: A rapid review and meta-analysis. J Glob Health 2022;12:05014. Creative Commons Attribution 4.0 International Public License\n\n![Photo by <a href=\"https://unsplash.com/@steverichey?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Steve Richey</a> on <a href=\"https://unsplash.com/s/photos/data-table?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\">Unsplash</a>](Table.jpg)\n\n##### **Table scraping**\n\nFirstly, I trialled scraping the table from page 4 of the journal paper, which only really scraped about half of the table. I then went on to add in another line of code to specify the scraping area[^1] on the PDF page in inches (this part could be deduced by using the in-built PDF tool).\n\n[^1]: Thanks to Stack Overflow as I've managed to find this solution from several different scenarios and comments.\n\nOne thing I wasn't too sure about was that the tabula-py documentation did state that the default = full page, but in fact, it appeared to be not the case (only half of the table showed up). Also, the journal paper I was using had the tables printed in landscape layout (rather than the more common portrait style), so it wasn't completely clear if landscape version was making this harder or the other way.\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\n#specify the scraping area (top, left, bottom, right)\ntest_area = \"10.05,6.60,10.05,6.60\" \ndf = read_pdf(\"Journal.pdf\", pages = \"4\", area = test_area, guess = False, stream = True, pandas_options={'header':None})\ndf\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```\n[                                                    0\n 0   VREIESWEAPROCINHT TSHEME 1:  Healey et al. COV...\n 1    Table 1. Characteristics of the included studies\n 2                             Author Hospital (%) Age\n 3   (country) {ICU (%)} (years) Comorbiditiestime ...\n 4   41% hypertension, 15% diabetes, Generalised/MS...\n 5   11% obesity, 11% endocrine disease, Respirator...\n 6   10% malignancy, 9% IHD, 8% Neuropsychiatric 43...\n 7    Bellan (Italy) dyslipidaemia, 7% AF, 6% COPD, 6%\n 8   100 {12} 61 107 ENT 5% gustatory dysfunction, ...\n 9             [19] CKD, 6% haematological disease, 5%\n 10             anxiety/depression, 4% cerebrovascular\n 11  disease, 3% liver disease, 3% VTE, 2% Gastroin...\n 12                         IBD, 2% autoimmune disease\n 13  Generalised/MSK Fatigue, myalgia, arthralgia, ...\n 14  Respiratory Dyspnoea, cough, chest pain, sputu...\n 15       Bliddal 28% allergy, 17% osteoarthritis, 15%\n 16  Neuropsychiatric Memory issues, concentration ...\n 17  (Denmark) 0 50 hypertension, 9% thyroid diseas...\n 18  ENT Olfactory dysfunction, gustatory dysfuncti...\n 19                                        [20] asthma\n 20  Gastrointestinal Diarrhoea, anorexia, abdomina...\n 21                              Others Red runny eyes\n 22        Chiesa- 6% hypertension, 6% hypothyroidism,\n 23  Estomba Not stated 41 6% asthma, 4% autoimmune...\n 24          (Italy) [21] 3% diabetes, 2% IHD, 1% COPD\n 25                                             Cousyn\n 26  0 35 Not stated 60 ENT 16.8% olfactory dysfunc...\n 27                                      (France) [22]\n 28  Generalised/MSK 45% fatigue, 15% myalgia, 3% f...\n 29  33% dyspnoea, 33% cough. Normal spirometry, no...\n 30                                        Respiratory\n 31                                   distance on 6MWT\n 32  Neuropsychiatric 18% cognitive issues, 15% hea...\n 33          Daher 59% hypertension, 25% diabetes, 22%\n 34  ENT 12% olfactory dysfunction, 12% rhinorrhoea...\n 35   (Germany) 100 64 CKD, 19% IHD, 13% asthma, 9% 56\n 36  9% diarrhoea, 6% nausea, 3% abdominal pain, no...\n 37  18% angina, normal left ventricular function, ...\n 38                                     Cardiovascular\n 39                                         biomarkers\n 40  Normal FBC, normal coagulation screen, raised ...\n 41                                   Other biomarkers\n 42  U&Es, normal CRP, normal procalcitonin, normal...\n 43  26% hypertension, 12% diabetes, Generalised/MS...\n 44                                         Fernandez-\n 45                 12% IHD, 7% asthma, 5% obesity, 4%\n 46                        de-Las-Penas 100 {7} 61 340\n 47  COPD, 2% cerebrovascular disease, 2% Respirato...\n 48                                       (Spain) [23]\n 49                            rheumatological disease\n 50  47% hypertension, 42% dyslipidaemia, Generalis...\n 51                                           Froidure\n 52  28% obesity, 22% diabetes, 9% Abnormal chest C...\n 53                           (Belgium) 100 {22} 60 98\n 54  asthma, 4% COPD, 2% lung cancer, Respiratory t...\n 55                                               [24]\n 56  1% ILD cough, 4% chest tightness, normal spiro...\n 57  2022  •  Vol. 12  •  05014 4 www.jogh.org •  d...]\n```\n:::\n:::\n\n\nOnce above worked, I moved onto scraping the whole table across pages 4 to 6 of the PDF, and then saved the scraped table into a .csv file, which appeared automatically in the working directory.\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nimport tabula\ntest_area = \"10.05,6.60,10.05,6.60\"\n# Convert and save scraped data into specified file format\ntabula.convert_into(\"Journal.pdf\", \"Full_table_scraped.csv\", output_format = \"csv\", pages = \"4-6\", area = test_area, guess = False, stream = True)\n!cat Full_table_scraped.csv\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nVREIESWEAPROCINHT TSHEME 1:  Healey et al. COVID-19 PANDEMIC\r\r\nTable 1. Characteristics of the included studies\r\r\nAuthor Hospital (%) Age\r\r\n(country) {ICU (%)} (years) Comorbiditiestime (days) Follow-up Body system Results\r\r\n\"41% hypertension, 15% diabetes, Generalised/MSK 5.9% myalgia, 5.9% arthralgia\"\r\r\n\"11% obesity, 11% endocrine disease, Respiratory 5.5% dyspnoea, 2.5% cough, 0.4% chest pain, 51.6% reduced DLCO, normal spirometry\"\r\r\n\"10% malignancy, 9% IHD, 8% Neuropsychiatric 43% PTSD symptoms\"\r\r\n\"Bellan (Italy) dyslipidaemia, 7% AF, 6% COPD, 6%\"\r\r\n\"100 {12} 61 107 ENT 5% gustatory dysfunction, 4.6% olfactory dysfunction\"\r\r\n\"[19] CKD, 6% haematological disease, 5%\"\r\r\n\"anxiety/depression, 4% cerebrovascular\"\r\r\n\"disease, 3% liver disease, 3% VTE, 2% Gastrointestinal 1.3% diarrhoea\"\r\r\n\"IBD, 2% autoimmune disease\"\r\r\n\"Generalised/MSK Fatigue, myalgia, arthralgia, chills, fever\"\r\r\n\"Respiratory Dyspnoea, cough, chest pain, sputum production\"\r\r\n\"Bliddal 28% allergy, 17% osteoarthritis, 15%\"\r\r\n\"Neuropsychiatric Memory issues, concentration issues, headache\"\r\r\n\"(Denmark) 0 50 hypertension, 9% thyroid disease, 8% 84\"\r\r\n\"ENT Olfactory dysfunction, gustatory dysfunction, sore throat, rhinorrhoea, sneezing\"\r\r\n[20] asthma\r\r\n\"Gastrointestinal Diarrhoea, anorexia, abdominal pain, nausea\"\r\r\nOthers Red runny eyes\r\r\n\"Chiesa- 6% hypertension, 6% hypothyroidism,\"\r\r\n\"Estomba Not stated 41 6% asthma, 4% autoimmune disease, 47 ENT 51% olfactory dysfunction\"\r\r\n\"(Italy) [21] 3% diabetes, 2% IHD, 1% COPD\"\r\r\nCousyn\r\r\n\"0 35 Not stated 60 ENT 16.8% olfactory dysfunction, 9.6% gustatory dysfunction\"\r\r\n(France) [22]\r\r\n\"Generalised/MSK 45% fatigue, 15% myalgia, 3% fever, slight pain/discomfort\"\r\r\n\"33% dyspnoea, 33% cough. Normal spirometry, normal ABG, reduced DLCO, reduced\"\r\r\nRespiratory\r\r\ndistance on 6MWT\r\r\n\"Neuropsychiatric 18% cognitive issues, 15% headache, mild depression, subthreshold anxiety\"\r\r\n\"Daher 59% hypertension, 25% diabetes, 22%\"\r\r\n\"ENT 12% olfactory dysfunction, 12% rhinorrhoea, 9% gustatory dysfunction, 9% sore throat\"\r\r\n\"(Germany) 100 64 CKD, 19% IHD, 13% asthma, 9% 56\"\r\r\n\"9% diarrhoea, 6% nausea, 3% abdominal pain, normal LFTs[17] COPD, 9% AF, 9% heart failureGastrointestinal\"\r\r\n\"18% angina, normal left ventricular function, normal right ventricular function, normal cardiac\"\r\r\nCardiovascular\r\r\nbiomarkers\r\r\n\"Normal FBC, normal coagulation screen, raised ferritin, potentially raised D-dimer, normal\"\r\r\nOther biomarkers\r\r\n\"U&Es, normal CRP, normal procalcitonin, normal TFTs, normal IL-6\"\r\r\n\"26% hypertension, 12% diabetes, Generalised/MSK 61.2% fatigue\"\r\r\nFernandez-\r\r\n\"12% IHD, 7% asthma, 5% obesity, 4%\"\r\r\nde-Las-Penas 100 {7} 61 340\r\r\n\"COPD, 2% cerebrovascular disease, 2% Respiratory 23.3% dyspnoea, 6.5% chest pain, 2.5% cough\"\r\r\n(Spain) [23]\r\r\nrheumatological disease\r\r\n\"47% hypertension, 42% dyslipidaemia, Generalised/MSK 25% fatigue\"\r\r\nFroidure\r\r\n\"28% obesity, 22% diabetes, 9% Abnormal chest CT: 67% ground glass opacities, 44% reticulations, 20% fibrotic lesions/\"\r\r\n(Belgium) 100 {22} 60 98\r\r\n\"asthma, 4% COPD, 2% lung cancer, Respiratory traction bronchiectasis, 7% consolidations. 46% reduced DLCO, 35% dyspnoea, 10% dry\"\r\r\n[24]\r\r\n\"1% ILD cough, 4% chest tightness, normal spirometry\"\r\r\n2022  •  Vol. 12  •  05014 4 www.jogh.org •  doi: 10.7189/jogh.12.05014\r\r\n\"\",,,,,,,Symptoms and signs of long COVID: A rapid review\r\r\nTable 1. continued,,,,,,,\r\r\nAuthor (country) Hospital (%) {ICU (%)},Age (years),,,Comorbidities,Follow-up time (days),,Body system Results\r\r\n\"\",,,,,,,Generalised/MSK 17% fatigue\r\r\nGerhards,,,,,,,\r\r\n\"\",,,,,,,\"Neuropsychiatric Depression, concentration issues\"\r\r\n(Germany) 10,46,,,Not stated,183,,\r\r\n\"\",,,,,,,ENT 27% olfactory/gustatory dysfunction\r\r\n[25],,,,,,,\r\r\n\"\",,,,,,,Others Alopecia\r\r\n\"\",,,,,,,\"Generalised/MSK Fatigue, arthralgia, myalgia\"\r\r\n\"\",,,,\"38% hypertension, 22% obesity, 19%\",,,\r\r\nGhosn,,,,,,,\"Respiratory Dyspnoea, cough\"\r\r\n100 {29},61,,,\"diabetes, 18% IHD, 10% COPD, 7%\",194,,\r\r\n(France) [26],,,,,,,Neuropsychiatric Headache\r\r\n\"\",,,,\"CKD, 7% malignancy, 1% liver disease\",,,\r\r\n\"\",,,,,,,\"ENT Rhinorrhoea, olfactory dysfunction, gustatory dysfunction, sore throat\"\r\r\n\"\",,,,,,,\"62% abnormal chest CT: 35% fibrotic-like changes, 27% ground glass opacities/interstitial\"\r\r\nHan (China),,,,\"28% hypertension, 14% respiratory\",,,\"thickening, nodules/masses, interlobar pleural traction, pulmonary atelectasis and\"\r\r\n100,54,,,,175,,Respiratory\r\r\n[27],,,,\"disease, 11% diabetes\",,,\"bronchiectasis. 26% reduced DLCO, 14% mild dyspnoea, 10% sputum production, 6.1% dry\"\r\r\n\"\",,,,,,,cough\r\r\n\"\",,,,,,,\"Generalised/MSK 50% fatigue, 35.7% arthralgia, 21.4% myalgia\"\r\r\nHolmes,,,,,,,\"Respiratory 28.6% cough, 25% dyspnoea, 3.6% chest pain\"\r\r\n(Australia) 0,57,,,Not stated,183,,Neuropsychiatric 10.7% headache\r\r\n[28],,,,,,,\"ENT 28.6% olfactory dysfunction, 14.3% rhinorrhoea\"\r\r\n\"\",,,,,,,Gastrointestinal No abdominal pain\r\r\n\"\",,,,\"49% obesity, 48% hypertension,\",,,\"Generalised/MSK 44.8% fatigue, 21.3% myalgia, 15.8% arthralgia, 1.1% fever, 1.1% ulcer\"\r\r\n\"\",,,,\"28% diabetes, 12% IHD, 11%\",,,\"Respiratory 31.7% dyspnoea, 25.1% cough, 14.8% sputum production\"\r\r\n\"\",,,,\"dyslipidaemia, 10% asthma, 10%\",,,\"Neuropsychiatric 12.6% headache, 8.7% cognitive issues\"\r\r\nJacobs (USA),,,,\"malignancy, 5% arrhythmia, 4%\",,,\r\r\n100,57,,,,35,,\"ENT 9.8% gustatory dysfunction, 9.3% olfactory dysfunction\"\r\r\n[29],,,,\"COPD, 4% hypothyroidism, 4%\",,,\r\r\n\"\",,,,,,,Gastrointestinal 3.8% diarrhoea\r\r\n\"\",,,,\"depression, anxiety or schizophrenia,\",,,\r\r\n\"\",,,,\"3% heart failure, 3% sleep apnoea, 2%\",,,\"Others 8.2% eye irritation, 1.1% ulcer\"\r\r\n\"\",,,,VTE,,,\r\r\n\"\",,,,\"36% obesity, 29% hypertension,\",,,\"Generalised/MSK 63% fatigue, 35% myalgia\"\r\r\nLeth,,,,\"12% malignancy, 10% IHD, 8%\",,,\"Respiratory 53% dyspnoea, 24% cough, 20% chest pain, 12% sputum production\"\r\r\n(Denmark) 100 {12},58,,,\"asthma, 8% COPD, 4% diabetes, 4%\",128,,\"Neuropsychiatric 45% concentration issues, 27% headache, 27% paraesthesia\"\r\r\n[30],,,,\"hyperthyroidism, 2% cerebrovascular\",,,\"ENT 31% gustatory dysfunction, 27% olfactory dysfunction, 10% sore throat\"\r\r\n\"\",,,,disease,,,\"Gastrointestinal 10% abdominal pain, 8% diarrhoea, 8% nausea, 4% anorexia\"\r\r\n\"\",,,,,,,\"Generalised/MSK 33% fatigue, 1.4% arthralgia, 0.6% myalgia\"\r\r\n\"\",,,,,,,\"Respiratory 8.5% cough, 7% dyspnoea, 0.8% chest pain\"\r\r\nMahmud,,,,,,,\r\r\n\"\",,,,,,,\"3.9% circadian rhythm disorders, 3.4% headache, 2.3% sleep disturbance, 1.4% adjustment\"\r\r\n(Bangladesh) Not stated,40,,,\"15% hypertension, 14% diabetes\",30,,Neuropsychiatric\r\r\n\"\",,,,,,,disorder\r\r\n[18],,,,,,,\r\r\n\"\",,,,,,,\"ENT 2.3% vertigo, 2% olfactory dysfunction\"\r\r\n\"\",,,,,,,Cardiovascular 1.4% palpitation\r\r\n\"\",,,,,,,RESEARCH THEME 1:\r\r\n\"\",,,,,,,VCOIEVWIDP-O1I9N PTASNDEMIC\r\r\nwww.jogh.org • doi: 10.7189/jogh.12.05014,,,,5,,,2022  •  Vol. 12  •  05014\r\r\nRVEIESWEAPROCINHT TSHEME 1:  Healey et al. COVID-19 PANDEMIC\r\r\nTable 1. continued\r\r\nAuthor Hospital (%) Age Follow-up\r\r\n(country) {ICU (%)} (years) Comorbidities time (days) Body system Results\r\r\nOtte\r\r\n\"42.3% subjective olfactory dysfunction, 26.9% objective olfactory dysfunction (discrimination\"\r\r\n(Germany) 0 45 Not stated 201 ENT\r\r\nand identification issues)\r\r\n[31]\r\r\n\"Generalised/MSK 13.1% fatigue, 8.2% rheumatological issues\"\r\r\n\"23% hypertension, 16% obesity, 6% Respiratory 6% dyspnoea, 2% cough, 0.8% chest pain\"\r\r\n\"Peghin (Italy) diabetes, 4% respiratory disease, 1% Neuropsychiatric 9.6% neurological disorders, 4.9% psychiatric disorders, 2.7% headache\"\r\r\n26 53 191\r\r\n\"[32] IHD, 2% liver disease, 1% depression/ ENT 10.4% olfactory/gustatory dysfunction,\"\r\r\n\"anxiety, 0% CKD Gastrointestinal 1.5% gastrointestinal disorders\"\r\r\n\"Others 3.7% alopecia, 3.4% cutaneous manifestations, 0.3% ocular symptoms\"\r\r\n\"Generalised/MSK 24% night sweats, 0% fever\"\r\r\n\"63% abnormal chest CT: ground-glass opacities, reticular lesions, consolidations, bronchial\"\r\r\n\"Respiratory dilation. 36% dyspnoea, abnormal spirometry: 22% reduced FVC, 22% reduced FEV1, normal\"\r\r\n\"40% cardiovascular disease, 30% FEV1/FVC. 21% reduced DLCO, 17% cough\"\r\r\n\"hypertension, 19% dyslipidaemia,\"\r\r\nSonnweber Neuropsychiatric 22% sleep disorders\r\r\n\"75 57 17% diabetes, 7% asthma, 7% CKD, 103\"\r\r\n(Austria) [16] ENT 19% olfactory dysfunction\r\r\n\"6% COPD, 6% liver disease, 6%\"\r\r\n\"malignancy, 1% ILD Gastrointestinal 9% diarrhoea/vomiting\"\r\r\n\"97% normal LVEF, 55% diastolic dysfunction on echo, 23% raised NT-proBNP, 10%\"\r\r\nCardiovascular\r\r\n\"pulmonary hypertension, 1% pericardial effusion\"\r\r\n\"Other biomarkers Raised D-dimer, potentially raised ferritin, normal CRP, normal procalcitonin, normal IL-6\"\r\r\n\"Generalised/MSK Fatigue, myalgia, fever\"\r\r\n\"Respiratory Dyspnoea, cough, chest pain\"\r\r\n\"Sudre (UK, 26% obesity, 14% respiratory disease, Neuropsychiatric Headache, paraesthesia, numbness, concentration/ memory issues\"\r\r\n\"USA, Sweden) 14 42 10% asthma, 3% diabetes, 2% IHD, 84\"\r\r\n\"[33] 1% CKD ENT Olfactory dysfunction, sore throat, hoarse voice, tinnitus, earache\"\r\r\n\"Gastrointestinal Diarrhoea, abdominal pain\"\r\r\nCardiovascular Palpitations/tachycardia\r\r\n\"Vaira (Italy) 29% obesity, 27% IHD, 15%\"\r\r\n\"23 51 60 ENT 21% olfactory dysfunction, 7.9% gustatory dysfunction\"\r\r\n\"[34] respiratory disease, 11% diabetes\"\r\r\n\"ICU – intensive care unit, IHD – ischaemic heart disease, AF – atrial fibrillation, COPD – chronic obstructive pulmonary disease, CKD – chronic kidney disease, VTE – venous thromboembolism, IBD – inflammatory bowel\"\r\r\n\"disease, NS – not stated, ILD – interstitial lung disease, MSK – musculoskeletal, ENT – ear, nose, and throat, OGD – olfactory-gustatory dysfunction, DLCO – diffusing capacity for carbon monoxide, PTSD – posttraumatic\"\r\r\n\"stress disorder, ABG – arterial blood gas, 6MWT – 6-min walk test, LFT – liver function test, FBC – full blood count, U&E – urea and electrolyte, CRP – c-reactive protein, TFT – thyroid function test, IL-6 – interleukin-6,\"\r\r\n\"FVC – forced vital capacity, FEV1 – forced expiratory volume in one second, NT-proBNP – N-terminal pro B-type natriuretic peptide\"\r\r\n2022  •  Vol. 12  •  05014 6 www.jogh.org •  doi: 10.7189/jogh.12.05014\r\r\n```\n:::\n:::\n\n\n##### **Short summary**\n\nThe PDF scraping exercise only worked to a certain degree[^2], as the data did not arrive in a proper tabular format. I've also gone on to read several online resources and looked into tabula-py and tabula-java, it was clearly shown in their GitHub repo that there were existing issues for tables that have merged cells, empty cells or no column lines (which was what I had in this case). All of them tend to result in jumbled or merged rows or columns. It tends to work better if the tables in the PDFs are already in a proper table format i.e. columns and rows marked by lines. Nevertheless, the purpose of scraping the table data was achieved as full data were there after checking, but just not in a clean and tidy state so the next post named, \"Long COVID - an update\" would take us into the next stage to see what this tabular data would tell us about long COVID (all done in R).\n\n[^2]: or it could be my ignorance to other better methods - please leave a comment as I'd like to learn!\n\n",
    "supporting": [
      "ExtractTableFromPDF_files"
    ],
    "filters": [],
    "includes": {}
  }
}